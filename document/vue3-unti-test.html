<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue单元测试指北 | DataFan UI</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="所有的伟大，都源于一个勇敢的开始">
    
    <link rel="preload" href="/assets/css/0.styles.61f56397.css" as="style"><link rel="preload" href="/assets/js/app.fbb00a38.js" as="script"><link rel="preload" href="/assets/js/2.2784263e.js" as="script"><link rel="preload" href="/assets/js/40.1bc3f5b7.js" as="script"><link rel="prefetch" href="/assets/js/10.dca66e9a.js"><link rel="prefetch" href="/assets/js/11.70a5ddb8.js"><link rel="prefetch" href="/assets/js/12.8c6d40d7.js"><link rel="prefetch" href="/assets/js/13.64ba72fb.js"><link rel="prefetch" href="/assets/js/14.009ac787.js"><link rel="prefetch" href="/assets/js/15.fd8378a0.js"><link rel="prefetch" href="/assets/js/16.dd26dbe5.js"><link rel="prefetch" href="/assets/js/17.76829008.js"><link rel="prefetch" href="/assets/js/18.e6e5543e.js"><link rel="prefetch" href="/assets/js/19.7ea3c23e.js"><link rel="prefetch" href="/assets/js/20.f1cf9eeb.js"><link rel="prefetch" href="/assets/js/21.f8c52346.js"><link rel="prefetch" href="/assets/js/22.758b3ec0.js"><link rel="prefetch" href="/assets/js/23.67a7a48f.js"><link rel="prefetch" href="/assets/js/24.475a90f9.js"><link rel="prefetch" href="/assets/js/25.efe349b4.js"><link rel="prefetch" href="/assets/js/26.6c749548.js"><link rel="prefetch" href="/assets/js/27.d166aa9e.js"><link rel="prefetch" href="/assets/js/28.43da4518.js"><link rel="prefetch" href="/assets/js/29.3cea99ae.js"><link rel="prefetch" href="/assets/js/3.30e359b9.js"><link rel="prefetch" href="/assets/js/30.ea700635.js"><link rel="prefetch" href="/assets/js/31.f1d4d465.js"><link rel="prefetch" href="/assets/js/32.0b2beb0a.js"><link rel="prefetch" href="/assets/js/33.5b864d31.js"><link rel="prefetch" href="/assets/js/34.3ebd8617.js"><link rel="prefetch" href="/assets/js/35.c887bfb5.js"><link rel="prefetch" href="/assets/js/36.5743c567.js"><link rel="prefetch" href="/assets/js/37.16584230.js"><link rel="prefetch" href="/assets/js/38.b036bcdf.js"><link rel="prefetch" href="/assets/js/39.9ec52d5d.js"><link rel="prefetch" href="/assets/js/4.4115b534.js"><link rel="prefetch" href="/assets/js/41.52820797.js"><link rel="prefetch" href="/assets/js/5.430e0c7a.js"><link rel="prefetch" href="/assets/js/6.9617d452.js"><link rel="prefetch" href="/assets/js/7.dc8a3d69.js"><link rel="prefetch" href="/assets/js/8.bb5f4b4c.js"><link rel="prefetch" href="/assets/js/9.d74d7196.js">
    <link rel="stylesheet" href="/assets/css/0.styles.61f56397.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DataFan UI</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/components/" class="nav-link">
  组件中心
</a></div><div class="nav-item"><a href="/design/" class="nav-link">
  规范文档
</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active">
  开发手册
</a></div><div class="nav-item"><a href="https://github.com/young-datafan/datafan-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/components/" class="nav-link">
  组件中心
</a></div><div class="nav-item"><a href="/design/" class="nav-link">
  规范文档
</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active">
  开发手册
</a></div><div class="nav-item"><a href="https://github.com/young-datafan/datafan-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/document/" aria-current="page" class="sidebar-link">开发手册</a></li><li><a href="/document/vue3/" class="sidebar-link">Vue3 新框架&amp;组件</a></li><li><a href="/document/pinia.html" class="sidebar-link">Pinia 新一代状态管理</a></li><li><a href="/document/TypeScript.html" class="sidebar-link">TypeScript</a></li><li><a href="/document/vue3-base.html" class="sidebar-link">Vue3 基础知识</a></li><li><a href="/document/x6/" class="sidebar-link">antv-X6</a></li><li><a href="/document/Promise/" class="sidebar-link">Promise对象</a></li><li><a href="/document/Closure/" class="sidebar-link">闭包和Http缓存机制</a></li><li><a href="/document/vue3-unti-test.html" aria-current="page" class="active sidebar-link">Vue3 单元测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#单元测试的作用" class="sidebar-link">单元测试的作用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#测试的重点" class="sidebar-link">测试的重点</a></li></ul></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#工具" class="sidebar-link">工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#vue-unit-test" class="sidebar-link">Vue Unit Test</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#vitest" class="sidebar-link">Vitest</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#运行" class="sidebar-link">运行</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#文件目录" class="sidebar-link">文件目录</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#命名规则" class="sidebar-link">命名规则</a></li></ul></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#渲染组件" class="sidebar-link">渲染组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#shallowmount" class="sidebar-link">shallowMount</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#describe-it-expect" class="sidebar-link">describe | it | expect</a></li></ul></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#测试props" class="sidebar-link">测试props</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#beforeeach-aftereach" class="sidebar-link">beforeEach | afterEach</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#setprops" class="sidebar-link">setProps</a></li></ul></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#模拟用户输入与点击事件" class="sidebar-link">模拟用户输入与点击事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#vm-setvalue" class="sidebar-link">vm | setValue</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#trigger" class="sidebar-link">trigger</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#computed-watch" class="sidebar-link">computed | watch</a></li></ul></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#测试emit" class="sidebar-link">测试emit</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#emitted" class="sidebar-link">emitted</a></li></ul></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#验证元素是否可见" class="sidebar-link">验证元素是否可见</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#isvisible" class="sidebar-link">isVisible</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#exists" class="sidebar-link">exists</a></li></ul></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#mock数据" class="sidebar-link">Mock数据</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#查找元素与组件" class="sidebar-link">查找元素与组件</a></li><li class="sidebar-sub-header"><a href="/document/vue3-unti-test.html#官网文档" class="sidebar-link">官网文档</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue单元测试指北"><a href="#vue单元测试指北" class="header-anchor">#</a> Vue单元测试指北</h1> <h2 id="单元测试的作用"><a href="#单元测试的作用" class="header-anchor">#</a> 单元测试的作用</h2> <p>测试有助于确保你的应用程序能够按照预期工作。</p> <p>具有高测试覆盖率的软件项目永远不会是完美的，但它是软件质量的一个良好的初始指标。此外，可测试的代码通常是一个良好的软件架构的标志，这就是为什么先进的开发人员在整个开发生命周期中都会考虑到测试。</p> <p>测试可以从三个层面考虑</p> <ul><li>单元测试</li> <li>集成测试</li> <li>端到端测试</li></ul> <p>单元测试是测试独立的代码单元的功能，与它的依赖关系隔离。</p> <p>单元测试是测试驱动开发（TDD）过程的一个基本部分。</p> <p>单元测试提高了代码的可维护性。</p> <h3 id="测试的重点"><a href="#测试的重点" class="header-anchor">#</a> 测试的重点</h3> <ul><li><strong>输入：</strong> data、props、用户交互、生命周期、用户存储、路由等</li> <li><strong>输出：</strong> 页面渲染、事件、数据返回、数据存储更新等</li></ul> <h2 id="工具"><a href="#工具" class="header-anchor">#</a> 工具</h2> <h3 id="vue-unit-test"><a href="#vue-unit-test" class="header-anchor">#</a> Vue Unit Test</h3> <p>Vue Test Utils（VTU）是一套旨在简化Vue.js组件测试的实用工具库。它提供一系列的方法来挂载组件与组件交互。</p> <h3 id="vitest"><a href="#vitest" class="header-anchor">#</a> Vitest</h3> <p>Vitest 是一个由 Vite 提供支持的极速单元测试框架。</p> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language- extra-class"><pre class="language-text"><code>pnpm add -S -D vitest @vue/test-utils happy-dom
</code></pre></div><h3 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h3> <p><code>package.json</code>的<code>scripts</code>中添加<code>&quot;test&quot;: &quot;vitest&quot;</code></p> <p><code>vite.config.js</code>中添加</p> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">environment</span><span class="token operator">:</span> <span class="token string">'happy-dom'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="运行"><a href="#运行" class="header-anchor">#</a> 运行</h3> <div class="language- extra-class"><pre class="language-text"><code>npx vitest // 默认以watch模式运行

或

pnpm run test
</code></pre></div><h3 id="文件目录"><a href="#文件目录" class="header-anchor">#</a> 文件目录</h3> <div class="language- extra-class"><pre class="language-text"><code>├── node_modules
├── public
├── src
    ├── assets
    └── components
        └── __tests__
</code></pre></div><h3 id="命名规则"><a href="#命名规则" class="header-anchor">#</a> 命名规则</h3> <p><code>Component.spec.js</code>   测试文件应与组件名称一致。</p> <h2 id="渲染组件"><a href="#渲染组件" class="header-anchor">#</a> 渲染组件</h2> <p>在<code>src/compoents</code>中创建<code>Greeting.vue</code>。组件唯一的内容就是渲染<code>greeting</code>内容</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    {{ greeting }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> greeting <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在<code>src</code>下创建<code>__test__/components</code>文件夹，并创建<code>Greeting.spec.js</code>文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vitest'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Greeting <span class="token keyword">from</span> <span class="token string">'@/components/Greeting.vue'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Greeting'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> wrapper <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'测试Greeting'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Greeting<span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="shallowmount"><a href="#shallowmount" class="header-anchor">#</a> shallowMount</h3> <p><code>shallowMount</code>是VTU提供的工具函数，用来创建组件实例。</p> <h3 id="describe-it-expect"><a href="#describe-it-expect" class="header-anchor">#</a> describe | it | expect</h3> <ul><li><code>describe</code>是一个将多个相关的测试组合在一起的块。
<ul><li><code>describe(name, fn)</code> <ul><li><code>name</code>：描述</li> <li><code>fn</code>：测试内容</li></ul></li></ul></li> <li><code>it</code>是测试具体的功能或函数。
<ul><li><code>it(name, fn, timeout)</code> <ul><li><code>name</code> 描述</li> <li><code>fn</code> 测试内容</li> <li><code>timeout</code>指定该测试套件每次运行的最长时间，默认为5秒</li></ul></li></ul></li> <li><code>expect</code>断言，判断值是否满足条件，通常搭配匹配器来使用。</li></ul> <p><strong><code>expect</code>常用匹配器</strong></p> <ul><li>Booleans:
<ul><li><code>toBeTruthy()</code> - 检查一个变量/语句是否为真</li> <li><code>toBeFalsy()</code> - 检查一个变量/语句是否为假</li></ul></li> <li>Defined:
<ul><li><code>toBeNull()</code> - 检查一个变量/语句是否为null</li> <li><code>toBeUndefined()</code> -检查一个变量/语句是否为真<code>undefined</code></li> <li><code>toBeDefined()</code> - 检查一个变量/语句是否为真 <code>defined</code></li></ul></li> <li>Numbers:
<ul><li><code>toBeGreaterThan()</code> - 检查一个数字是否大于指定值</li> <li><code>toBeGreaterThanOrEqual()</code> - 检查一个数字是否大于或等于指定的值</li> <li><code>toBeLessThan()</code> - 检查一个数字是否小于指定的值</li> <li><code>toBeLessThanOrEqual()</code> - 检查一个数字是否小于或等于指定的值。</li></ul></li> <li>Strings:
<ul><li><code>toMatch()</code> - 检查一个字符串是否匹配指定的值</li></ul></li> <li>Arrays:
<ul><li><code>toContain()</code> - 检查一个数组是否包含指定的值</li></ul></li> <li><code>toBe()</code> and <code>toEqual()</code> - 检查一个值是否与指定的值相同。</li></ul> <p>修饰符<code>not</code>可与上面的匹配器一起使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span><span class="token string">'Vue Project'</span><span class="token punctuation">)</span>
</code></pre></div><p>完整的 <a href="https://vitest.dev/api/#expect" target="_blank" rel="noopener noreferrer">Vitest API 列表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="测试props"><a href="#测试props" class="header-anchor">#</a> 测试props</h2> <h3 id="beforeeach-aftereach"><a href="#beforeeach-aftereach" class="header-anchor">#</a> beforeEach | afterEach</h3> <p>Vitest提供<code>beforeEach</code> 与 <code>afterEach</code> 用来处理组件初始化与测试完毕之后的要做的事。</p> <ul><li><code>beforeEach</code> 在执行测试之前被调用
<ul><li><code>beforeEach(fn, timeout)</code> <ul><li><code>fn</code>函数，如果使用<code>async/await</code>，则测试内容会在全部<code>await</code>完成之后再执行</li> <li><code>timeout</code> 超时时间</li></ul></li></ul></li> <li><code>afterEach</code> 在每一个测试执行结束后被调用
<ul><li><code>afterEach(fn, timeout)</code> <ul><li><code>fn</code>函数，如果使用<code>async/await</code>，则<code>Vitest</code>在全部<code>await</code>完成之后再继续。</li> <li><code>timeout</code> 超时时间</li></ul></li></ul></li></ul> <h3 id="setprops"><a href="#setprops" class="header-anchor">#</a> setProps</h3> <p>通过<code>setProps()</code>设置<code>props</code>传入数据，<code>flushPromises()</code>返回一个<code>promise</code>，表示组件更新完成。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> beforeEach<span class="token punctuation">,</span> afterEach <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vitest'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Greeting <span class="token keyword">from</span> <span class="token string">'@/components/Greeting.vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> flushPromises <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Greeting'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> wrapper <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Greeting<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">propsData</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">what</span><span class="token operator">:</span> <span class="token string">'Wo'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper<span class="token punctuation">.</span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'测试Greeting'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'Hello, Wo'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'测试props传入'</span><span class="token punctuation">,</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 组件初始化</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'Wo'</span><span class="token punctuation">)</span>

    <span class="token comment">// 设置props</span>
    wrapper<span class="token punctuation">.</span><span class="token function">setProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">what</span><span class="token operator">:</span> <span class="token string">'World'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 等待组件刷新完成</span>
    <span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 验证props传入与页面显示</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'Hello, World'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="模拟用户输入与点击事件"><a href="#模拟用户输入与点击事件" class="header-anchor">#</a> 模拟用户输入与点击事件</h2> <p>新建文件<code>Weather.vue</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>temperature<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>number<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>setTemperature<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>温度 - 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>今天的温度：{{temperature}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>今天的天气：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{status}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
  <span class="token keyword">const</span> temperature <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">setTemperature</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    temperature<span class="token punctuation">.</span>value<span class="token operator">--</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> temperature<span class="token punctuation">.</span>value <span class="token operator">&lt;</span> <span class="token number">30</span> <span class="token operator">?</span> <span class="token string">'凉爽'</span> <span class="token operator">:</span> <span class="token string">'热死'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>创建相应的测试文件<code>Weather.spec.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> beforeEach<span class="token punctuation">,</span> afterEach <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vitest'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Weather <span class="token keyword">from</span> <span class="token string">'@/components/Weather.vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> flushPromises <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Weather'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> wrapper <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Weather<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper<span class="token punctuation">.</span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'测试用户输入'</span><span class="token punctuation">,</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置输入值</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>temperature <span class="token operator">=</span> <span class="token number">40</span>
    <span class="token comment">// await wrapper.find('input[type=&quot;number&quot;]').setValue(40)</span>
    <span class="token comment">// 等待组件刷新</span>
    <span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 断言输入值</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.temp'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'40'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'测试用户点击'</span><span class="token punctuation">,</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置输入值</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>temperature <span class="token operator">=</span> <span class="token number">40</span>
    <span class="token comment">// 点击按钮</span>
    wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 断言输入值</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.temp'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'39'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'测试computed'</span><span class="token punctuation">,</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 组件初始化</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>temperature <span class="token operator">=</span> <span class="token number">40</span>
    <span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.status'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'热死'</span><span class="token punctuation">)</span>
    <span class="token comment">// 修改数据</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>temperature <span class="token operator">=</span> <span class="token number">20</span>
    <span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 验证computed</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.status'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'凉爽'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="vm-setvalue"><a href="#vm-setvalue" class="header-anchor">#</a> vm | setValue</h3> <p>VTU提供<code>vm</code>来获取组件实例，可通过它来获取组件内部变量值，或调用组件中定义的方法。可以通过<code>vm</code>直接改变组件中的变量，但需搭配<code>flushPromises()</code>等待组件刷新，或者查找组件，使用<code>setValue</code>搭配<code>await</code>来模拟用户输入。</p> <h3 id="trigger"><a href="#trigger" class="header-anchor">#</a> trigger</h3> <p>提供<code>trigger</code>来触发<code>click</code>,<code>select</code>,<code>keyup</code>等事件</p> <h3 id="computed-watch"><a href="#computed-watch" class="header-anchor">#</a> computed | watch</h3> <p><code>computed</code>与<code>watch</code>的测试与普通函数一样</p> <h2 id="测试emit"><a href="#测试emit" class="header-anchor">#</a> 测试emit</h2> <p>新建<code>Emitter.vue</code> 和 <code>Emitter.spec.js</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code>// Emitter.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineEmits <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'myEmit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">emitEvent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'myEmit'</span><span class="token punctuation">,</span> <span class="token string">'Emitted!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Emitter.spec.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vitest'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Emitter <span class="token keyword">from</span> <span class="token string">'@/components/Emitter.vue'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Emitter'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> wrapper <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Test Emit'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Emitter<span class="token punctuation">)</span>

    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">emitEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'myEmit'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>myEmit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveLength</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>myEmit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Emitted!'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Test Emitted twice'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Emitter<span class="token punctuation">)</span>

    <span class="token comment">// 触发两次</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">emitEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">emitEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'myEmit'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>myEmit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveLength</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>myEmit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Emitted!'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'Emitted!'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>myEmit<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Emitted!'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>通过<code>vm</code>访问组件中的方法，触发<code>emit</code>事件</p> <h3 id="emitted"><a href="#emitted" class="header-anchor">#</a> emitted</h3> <p>VTU提供<code>emitted</code>的，返回组件中所有发生的<code>emit</code>事件，返回格式为数组。</p> <h2 id="验证元素是否可见"><a href="#验证元素是否可见" class="header-anchor">#</a> 验证元素是否可见</h2> <h3 id="isvisible"><a href="#isvisible" class="header-anchor">#</a> isVisible</h3> <p>断言 <code>Wrapper</code> 是否可见。</p> <p>如果有一个祖先元素拥有 <code>display: none</code> 或 <code>visibility: hidden</code> 样式则返回 <code>false</code>。</p> <p>这可以用于断言一个组件是否被 <code>v-show</code> 所隐藏。</p> <p><font color="red"><code>isVisible</code>在实际测试过程中发现返回的结果永远是true</font></p> <blockquote><p><a href="https://github.com/vuejs/vue-test-utils/issues/327" target="_blank" rel="noopener noreferrer">Issue地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="exists"><a href="#exists" class="header-anchor">#</a> exists</h3> <p>断言 <code>Wrapper</code> 是否存在，与<code>v-is</code>搭配使用 。</p> <p>使用方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'isVisible'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> wrapper <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Test visible'</span><span class="token punctuation">,</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>isVisible<span class="token punctuation">)</span>
    
    <span class="token comment">// expect(wrapper.find('.useShow').isVisible()).toBe(false)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.useIf'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>useIf <span class="token operator">=</span> <span class="token boolean">true</span>

    <span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// expect(wrapper.find('.useShow').isVisible()).toBe(false)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.useIf'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.useIf'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'If'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="mock数据"><a href="#mock数据" class="header-anchor">#</a> Mock数据</h2> <p>当单元测试中遇到涉及到接口调用的情况时，通常使用mock来代替实际的接口调用。</p> <p><strong>优点</strong></p> <ul><li>不依赖网络请求</li> <li>API发生故障时，测试不会中断</li> <li>运行速度快</li></ul> <p>需要引入<code>axios</code>，但不使用<code>axios</code>实际的调用接口，而是通过<code>vi.mock</code>创建它的模拟。</p> <p><code>vi</code> 是<code>Vitest</code>提供的工具函数。</p> <p><code>vi.mock</code>模拟传递模块的所有<code>imports</code></p> <p><code>vi.fn</code>为函数创建一个监听。每次调用函数时，会存储它的参数、返回值和实例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> beforeEach<span class="token punctuation">,</span> afterEach<span class="token punctuation">,</span> vi <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vitest'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> flushPromises <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> HttpRequestComponent <span class="token keyword">from</span> <span class="token string">'@/components/Http.vue'</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&quot;axios&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">get</span><span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'HttpRequestComponent'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> wrapper <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>HttpRequestComponent<span class="token punctuation">)</span>
    <span class="token keyword">const</span> getResp <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HZ'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">temp</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
          <span class="token literal-property property">temp_min</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token literal-property property">temp_max</span><span class="token operator">:</span> <span class="token number">40</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    axios<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span>getResp<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    axios<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockReset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'test axios mock'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">searchCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 验证是否发送请求</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span>get<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment">// 验证返回结果</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'名称：HZ'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'当前温度：30'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'最高温：40'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'最低温：20'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="查找元素与组件"><a href="#查找元素与组件" class="header-anchor">#</a> 查找元素与组件</h2> <ul><li><p><code>find</code></p> <ul><li><code>find</code>基本上是<code>querySelector</code>，另外，还支持<code>ref</code>的方式查找</li></ul></li> <li><p><code>findAll</code></p> <ul><li>同上</li></ul></li> <li><p><code>findComponent</code></p> <ul><li><table><thead><tr><th>syntax</th> <th>example</th> <th>details</th></tr></thead> <tbody><tr><td>querySelector</td> <td><code>findComponent('.component')</code></td> <td>Matches standard query selector.</td></tr> <tr><td>Component name</td> <td><code>findComponent({name: 'a'})</code></td> <td>matches PascalCase, snake-case, camelCase</td></tr> <tr><td>Component ref</td> <td><code>findComponent({ref: 'ref'})</code></td> <td>Can be used only on direct ref children of mounted component</td></tr> <tr><td>SFC</td> <td><code>findComponent(Component)</code></td> <td>Pass an imported component</td></tr></tbody></table></li></ul></li> <li><p><code>findAllComponents</code></p> <ul><li>同上，但<font color="red"><code>findAllComponents</code> 不支持 ref 语法</font>。所有其查询语法均有效。</li></ul></li></ul> <h2 id="官网文档"><a href="#官网文档" class="header-anchor">#</a> 官网文档</h2> <p><a href="https://test-utils.vuejs.org/" target="_blank" rel="noopener noreferrer">VueUnitTest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://vitest.dev/" target="_blank" rel="noopener noreferrer">Vitest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/document/Closure/" class="prev">
        闭包和Http缓存机制
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fbb00a38.js" defer></script><script src="/assets/js/2.2784263e.js" defer></script><script src="/assets/js/40.1bc3f5b7.js" defer></script>
  </body>
</html>
